<!DOCTYPE html>
<f:view lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" xmlns:o="http://omnifaces.org/ui"
	xmlns:of="http://omnifaces.org/functions">
	<h:body>
		<ui:remove> <!-- *****************  style and script ************************* --> </ui:remove>
		<style>
			.title {
				font-size: 12px;
				font-weight: bold;
				font-family: Calibri;
			}
			
			.dataValue {
				font-size: 12px;
				font-weight: normal;
				font-family: arial, sans-serif;
			}
		</style>
		
		<h:form id="formManualAnnotation">
		
			<p:remoteCommand name="calledOnLoad"
				oncomplete="loadFlashTree('#{annotationBacking.annotation.ontologyID}', '#{annotationBacking.annotation.nodeID}');"/>
			<p:remoteCommand name="lookupAnnotationParam" partialSubmit="true"
				update="ontologyTermName ontologyDefinition"
				action="#{annotationBacking.lookupDefinition}"/>
			<p:remoteCommand name="updateSelectedPoint"
				action="#{annotationBacking.updateSelectedPoint}" 
				update="selectedAnnotationData"/>
			<p:remoteCommand name="discardSelectedPoint"
				action="#{annotationBacking.discardSelectedPoint}" 
				update="selectedAnnotationData"/>
			
			<p:layout id="manualAnnotation" style="width:100%;height:550px" >
			
				<p:layoutUnit id="ontologyTree" position="west" header="Bioportal" size="300px" collapsible="true">
					<ui:remove> <!-- *****************  Left Panel, Ontology Tree ************************* --> </ui:remove>
					<h:panelGroup id="panelLeft" style="background-color:#d0e4f6; padding:20 0; height:360px; width:300px">
						<h:panelGroup rendered="#{annotationBacking.newTree}">
							<script src="/visualize-portlet/js/widgets/jquery.ncbo.tree.js"></script>
							<link rel="stylesheet" type="text/css" href="http://localhost:8080/visualize-portlet/css/widgets/jquery.ncbo.tree.css"></link>
							<div id="tree"></div>
							<script>
								var widget_tree = $("#tree").NCBOTree({
								  apikey: "24e0e602-54e0-11e0-9d7b-005056aa3316",
								  ontology: "ECGT",
								  ncboUIURL: "http://bioportal.bioontology.org",
								  ncboAPIURL: "http://data.bioontology.org"
								});
							</script>
						</h:panelGroup>
						<h:panelGroup rendered="#{!annotationBacking.newTree}">
							<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"
								id="OntologyTree" width="300" height="475"
								codebase="http://fpdownload.macromedia.com/get/flashplayer/current/swflash.cab">
								<param name="movie" value="http://keg.cs.uvic.ca/ncbo/ontologytree/OntologyTree.swf" />
								<param name="quality" value="high" />
								<param name="bgcolor" value="#ffffff" />
								<param name="allowScriptAccess" value="always" />
								<param name="flashVars" value="ontology=2079&amp;alerterrors=false&amp;canchangeontology=true&amp;virtual=true" />
								<embed src="http://keg.cs.uvic.ca/ncbo/ontologytree/OntologyTree.swf" quality="high" bgcolor="#ffffff"
									width="300" height="475" name="OntologyTree" align="middle"
									play="true"
									loop="false"
									allowScriptAccess="always"
									type="application/x-shockwave-flash"
									flashVars="ontology=2079&amp;alerterrors=false&amp;canchangeontology=true&amp;virtual=true"
									pluginspage="http://www.adobe.com/go/getflashplayer">
								</embed>
							</object>
						</h:panelGroup>
					</h:panelGroup>
					<ui:remove> <!-- *****************  Left Panel Row 2, tree reseting buttons ************************* --> </ui:remove>
					<h:panelGroup id="treeButtons" layout="block" style="align:center">
						<p:commandButton value="ECG Ontology" title="Show the points and intervals branches of the ECG ontology." oncomplete="loadOntology(42932);"/>
						<p:commandButton value="ECG Intervals Ontology" title="Show only the intervals branch of the ECG ontology." oncomplete="loadOntology(48037);" />
					</h:panelGroup>
				</p:layoutUnit>
				
				<p:layoutUnit id="annotation" position="center" header="Annotation">
					<ui:remove> <!-- *****************  Right Panel, Graph onclick data: ECG attributes & Selected points & Term Selection/manual comments ************************* --> </ui:remove>
					<ui:remove> <!-- *****************  Alternate Right Panel, Fine tune Graph   graphContainer- height:350px;************************* --> </ui:remove>
	
					<p:panel id="panelRightAlternate" styleClass="fineTuningGraph" widgetVar="fineTuningGraph" visible="false" header="Fine tunig Graph" style="position: relative;width:0%; float: right; height:99%; overflow: auto;">				
						<h:panelGroup  layout="block" style="top:0; padding:0;">
							<h:panelGrid id="graphContainer" columns="1" border="0" style="background-color:#d0f6d0; top:0; padding:0 0;" rendered="#{visualizeSharedBacking.showFineGraph}">
								<h:panelGroup id="fineTune_div" layout="block" class="graph" style="border:2; ">
									GRAPH WILL GO HERE
									<h:graphicImage value="/image/graph-loader.gif" title="graph loading indicator" alt="graph loading indicator" />
								</h:panelGroup>
			
								<h:panelGroup id="status_div" layout="block" style="height:20px;">
									Mouse over graph to see data details.
								</h:panelGroup>
			
								<h:panelGroup id="editButton_div" layout="block" style="align:right">
										<p:commandButton value="Update" 
											title="Save the newly selected point." 
											rendered="#{not visualizeSharedBacking.previousAnnotation}"
											actionListener="#{annotationBacking.showNewAnnotationDetails}"
											oncomplete="updateFineTuning();hideManualGraphPanel();"/>
										<p:commandButton value="Discard"
											title="Discard the newly selected point and restore the previous point."
											rendered="#{not visualizeSharedBacking.previousAnnotation}"
											actionListener="#{annotationBacking.showNewAnnotationDetails}"
											oncomplete="discardFineTuning();hideManualGraphPanel();" />
										<p:commandButton value="Close Graph"
											title="Close the graph and show the numbers chart."
											actionListener="#{annotationBacking.showNewAnnotationDetails}"
											oncomplete="fineTuningPoint=-1;hideManualGraphPanel();" />
								</h:panelGroup>
							</h:panelGrid>				
						</h:panelGroup>
					</p:panel>
					<p:panel id="panelRight" styleClass="annotationData" style="background-color:#d0e4f6; top:2px; padding:0px; height:99%; width:99.9%; position: absolute; overflow: auto;" >
						<ui:remove> <!-- *****************  Right Panel, Upper section: ECG attributes ************************* --> </ui:remove>
						<h:panelGrid id="GraphClickData" columns="2" frame="none" border="0" cellpadding="0" cellspacing="0" styleClass="title" style="vertical-align:text-top;width:100%;">
	
							<ui:remove> <!-- *****************  Right Panel, Upper left section: ECG attributes ************************* --> </ui:remove>
							<p:fieldset legend="ECG Info" style="min-height: 150px;"> 
								<p:panelGrid id="ECG_Attributes" style="width:100%;">
									<p:row>
										<p:column style="font-weight: bold;" >Subject ID</p:column>
										<p:column><h:outputLabel value="#{annotationBacking.studyEntry.recordName}" styleClass="dataValue" /></p:column>
									</p:row>
									<p:row>
										<p:column style="font-weight: bold;" >Lead</p:column>
										<p:column><h:outputLabel value="#{annotationBacking.leadName}" styleClass="dataValue" /></p:column>
									</p:row>
									<p:row>
										<p:column style="font-weight: bold;" >Rate</p:column>
										<p:column><h:outputLabel value="#{annotationBacking.studyEntry.samplingRate}Hz" styleClass="dataValue" /></p:column>
									</p:row>
									<p:row>
										<p:column style="font-weight: bold;" >Annotations</p:column>
										<p:column><h:outputLabel value="#{visualizeSharedBacking.annotationCount}" styleClass="dataValue" /></p:column>
									</p:row>
								</p:panelGrid>
							</p:fieldset>
	
							<ui:remove> <!-- *****************  Right Panel, Upper right Section: Selected points ************************* --> </ui:remove>
							<p:fieldset legend="Selection" style="min-height: 150px"> 
								<p:panelGrid style="width:100%;" id="selectedAnnotationData">  
								    <f:facet name="header">  
								        <p:row>
								        	<p:column ></p:column>  
								            <p:column >Onset</p:column>
								            <p:column >Offset</p:column>
								            <p:column >Change</p:column>  
								        </p:row>
							        </f:facet>
							          
									<p:row>
										<p:column style="font-weight: bold;">Time(mSec)</p:column>
										<p:column><h:outputText id="dataSX" styleClass="dataValue" value="#{annotationBacking.annotation.dataOnsetX}" /></p:column>
										<p:column><h:outputText id="dataSXDuration" styleClass="dataValue" value="#{annotationBacking.annotation.dataOffsetX}" rendered="#{!annotationBacking.annotation.singlePoint}"/></p:column>
										<p:column><h:outputText id="dataSXDuration2" styleClass="dataValue" value="#{annotationBacking.annotation.dataXChange}" rendered="#{!annotationBacking.annotation.singlePoint}"/></p:column>
									</p:row>
									
									<p:row>
										<p:column style="font-weight: bold;">Amplitude(Î¼V)</p:column>
										<p:column><h:outputText id="dataSY" styleClass="dataValue" value="#{annotationBacking.annotation.dataOnsetY}" /></p:column>
										<p:column><h:outputText id="dataSYDuration" styleClass="dataValue" value="#{annotationBacking.annotation.dataOffsetY}" rendered="#{!annotationBacking.annotation.singlePoint}" /></p:column>
										<p:column><h:outputText id="dataSYDuration2" styleClass="dataValue" value="#{annotationBacking.annotation.dataYChange}" rendered="#{!annotationBacking.annotation.singlePoint}"/></p:column>
									</p:row>
									
									<f:facet name="footer">
										<p:row>
											<p:column style="font-weight: bold;">Adjust</p:column>  
											<p:column>
												<p:commandButton value="Chg" style="height:80%"
														 title="Fine tune the selected onset time." 
														 actionListener="#{annotationBacking.showNewAnnotationGraph}"
														 update="panelRightAlternate"
														 oncomplete="fineTuningPoint=0;renderSingleGraphFineTuner('#{annotationBacking.annotation.dataOnsetX}',true, '#{annotationBacking.annotation.termName}');showManualGraphPanel();"/>
											</p:column>
											<p:column>
												<p:commandButton value="Chg"
														 title="Fine tune the selected Offset time."
														 rendered="#{!annotationBacking.annotation.singlePoint}"
														 actionListener="#{annotationBacking.showNewAnnotationGraph}"
														 update="panelRightAlternate"
														 oncomplete="fineTuningPoint=1; renderSingleGraphFineTuner('#{annotationBacking.annotation.dataOffsetX}', true, '#{annotationBacking.annotation.termName}');showManualGraphPanel();"/>
											</p:column>
											<p:column>
												<p:commandButton value="All"
														 title="View the entire interval."
														 rendered="#{!annotationBacking.annotation.singlePoint}"
														 actionListener="#{annotationBacking.showNewAnnotationGraph}"
														 update="panelRightAlternate"
														 oncomplete="fineTuningPoint=-1; renderSingleGraphFullAnnotation('#{annotationBacking.annotation.dataOnsetX}', '#{annotationBacking.annotation.dataOffsetX}', true);showManualGraphPanel();"/>
											</p:column>
										</p:row>
									</f:facet>
								</p:panelGrid>
								<script>
									singlePoint = #{annotationBacking.annotation.singlePoint};
								</script>
								
							</p:fieldset>
						</h:panelGrid>
							
							
						<ui:remove> <!-- *****************  Right Panel, Lower Section: Term Selection/manual comments ************************* --> </ui:remove>
						<p:panelGrid id="termSelection" style="background: whiteSmoke; width:100%; margin: 10px 0;">
	
							<h:outputLabel for="nodeIDName" value="*" rendered="false" />
							<h:outputText id="nodeIDDOM" class="nodeIDsendDOM" value="#{annotationBacking.annotation.nodeID}" rendered="false" />
	
							<f:facet name="header">  
								<p:row>
									<p:column colspan="2"> <h:outputLabel styleClass="title" value="Find the term in the bioportal ontology tree." /> </p:column>
								</p:row>
							</f:facet>
	
							<p:row>
								<p:column><h:outputLabel for="ontologyTermName" styleClass="title" value="Term:" /></p:column>
								<p:column><h:outputText id="ontologyTermName" styleClass="dataValue" value="#{annotationBacking.annotation.termName}" required="true" /></p:column>
							</p:row>
							<p:row>
								<p:column><h:outputLabel for="ontologyDefinition" styleClass="title" value="Definition" /></p:column>
								<p:column><h:outputText id="ontologyDefinition" styleClass="dataValue" value="#{annotationBacking.annotation.fullAnnotation}" /></p:column>
							</p:row>
							<p:row>
								<p:column><h:outputLabel for="manualComment" styleClass="title" value="Comment" /></p:column>
								<p:column>
									<h:inputTextarea id="manualComment" styleClass="dataValue"  rows="5" style="width:100%" value="#{annotationBacking.annotation.comment}"  />
								</p:column>
							</p:row>
							
							<f:facet name="footer">
								<p:row>
									<p:column colspan="2">
										<ui:remove> <!-- *****************  Right Panel Row 2, Buttons ************************* --> </ui:remove>
										<h:panelGroup id="buttons" layout="block" style="float: right;">
											<p:commandButton value="Cancel"
												action="#{annotationBacking.viewSingleGraph}"
												oncomplete=""
												title="Close manual annotation panel without saving." />
											<p:commandButton value="Save"
												disabled="#{visualizeSharedBacking.previousAnnotation}"
												actionListener="#{annotationBacking.saveAnnotationSetFlag}"
												action="#{annotationBacking.viewSingleGraph}" 
												/>
										</h:panelGroup>
									</p:column>
								</p:row>
							</f:facet>
						</p:panelGrid>
					</p:panel>
					
				</p:layoutUnit>
			</p:layout>
		</h:form>
	</h:body>
</f:view>